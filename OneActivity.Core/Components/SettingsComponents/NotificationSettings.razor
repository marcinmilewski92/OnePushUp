@using OneActivity.Core.Services
@inject ISharedContent Shared

<div class="card mt-4">
    <div class="card-header">
        <h3>Push Notifications</h3>
    </div>
    <div class="card-body">
        @if (_isLoading)
        {
            <p>Loading notification settings...</p>
        }
        else
        {
            <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="notificationsEnabled"
                       @bind="@_notificationsEnabled" @bind:after="ToggleNotifications" />
                <label class="form-check-label" for="notificationsEnabled">
                    Enable daily reminder notifications
                </label>
            </div>
            
            @if (_notificationsEnabled)
            {
                <div class="alert alert-info" role="alert">@Shared.NotificationReliabilityInfo</div>
                <div class="mb-3">
                    <label for="notificationTime" class="form-label">Reminder time</label>
                    <input type="time" class="form-control" id="notificationTime"
                           step="60" value="@_notificationTimeText" @oninput="OnTimeInputChanged" />
                    <div class="form-text">
                        Use 24-hour format HH:mm (e.g., 08:00). You will receive a notification at this time every day.
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header">
                        <strong>@Shared.NotificationDiagnosticsTitle</strong>
                    </div>
                    <div class="card-body">
                        <div class="row g-2 align-items-center mb-2">
                            <div class="col-sm-8">
                                @Shared.ExactAlarmsAllowedLabel <strong>@(ExactAlarmAllowed == true ? "Yes" : ExactAlarmAllowed == false ? "No" : "—")</strong>
                            </div>
                            <div class="col-sm-4 text-sm-end">
                                <button class="btn btn-outline-primary btn-sm" @onclick="OpenExactAlarmSettings">@Shared.OpenExactAlarmSettingsButton</button>
                            </div>
                        </div>
                        <div class="row g-2 align-items-center">
                            <div class="col-sm-8">
                                @Shared.IgnoringBatteryOptimizationsLabel <strong>@(IgnoringBatteryOptimizations == true ? "Yes" : IgnoringBatteryOptimizations == false ? "No" : "—")</strong>
                            </div>
                            <div class="col-sm-4 text-sm-end">
                                <button class="btn btn-outline-primary btn-sm" @onclick="OpenBatterySettings">@Shared.OpenBatteryOptimizationSettingsButton</button>
                            </div>
                        </div>
                    </div>
                </div>
            }
            
            @if (!string.IsNullOrEmpty(_message))
            {
                <div class="alert @(_isError ? "alert-danger" : "alert-success") mt-3">
                    @_message
                </div>
            }
        }
    </div>
</div>
